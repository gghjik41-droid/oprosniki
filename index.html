<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ü–°–û –ü–∞–Ω–µ–ª—å –û–ø—Ä–æ—Å–Ω–∏–∫–æ–≤</title>
    <style>
        /* –û–°–ù–û–í–ù–û–ô –í–ò–ó–£–ê–õ */
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; padding-top: env(safe-area-inset-top); background-color: #eceff1; min-height: 100vh; display: flex; flex-direction: column; overflow-y: auto; overflow-x: hidden; }
        
        /* –®–ê–ü–ö–ê –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .header-nav { background-color: #37474f; padding: 4px 8px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 1000; position: fixed; top: 0; left: 0; right: 0; height: 40px; overflow-x: auto; white-space: nowrap; scrollbar-width: none; }
        .header-nav::-webkit-scrollbar { display: none; }
        
        /* –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
        .clear-btn { background-color: #b71c1c; color: white; border: none; width: 30px; height: 30px; border-radius: 4px; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .pin-btn { background-color: #546e7a; color: white; border: none; width: 30px; height: 30px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .pin-btn.active { background-color: #0288d1; }
        .nav-btn { background-color: #455a64; color: #cfd8dc; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px; text-transform: uppercase; white-space: nowrap; }
        .nav-btn.active { background-color: #00c853; color: #fff; }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–†–´ */
        .main-wrapper { display: flex; width: 100%; padding: 5px; padding-right: 20px; margin-top: 48px; gap: 10px; box-sizing: border-box; align-items: flex-start; }
        .form-side { flex: 0 0 55%; background: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); padding: 12px; box-sizing: border-box; position: relative; }
        .result-side { flex: 0 0 45%; display: flex; flex-direction: column; gap: 8px; position: relative; }
        
        /* –õ–ò–ü–ö–ê–Ø –ó–ê–Ø–í–ö–ê */
        .sticky-header { background: white; padding: 10px 12px; border-bottom: 2px solid #eee; position: fixed; top: 55px; left: 5px; width: calc(55% - 14px); z-index: 999; box-sizing: border-box; border-radius: 4px 4px 0 0; box-shadow: 0 4px 6px -2px rgba(0,0,0,0.1); }
        .sticky-header.unpinned { position: static !important; width: 100% !important; padding: 0 0 8px 0; margin-bottom: 10px; box-shadow: none; }
        
        /* –≠–õ–ï–ú–ï–ù–¢–´ –í–í–û–î–ê */
        #z_text { width: 100%; min-height: 75px; padding: 6px; box-sizing: border-box; border: 1px solid #cfd8dc; border-radius: 4px; font-family: inherit; font-size: 14px; }
        #z_fixed { display: none; background: #f1f8e9; padding: 8px; border-radius: 6px; border: 1px solid #c8e6c9; line-height: 1.4em; font-size: 13px; color: #1b5e20; white-space: pre-wrap; }
        .btn-ok { margin-top: 6px; background: #4caf50; color: white; border: none; border-radius: 4px; padding: 10px; width: 100%; cursor: pointer; font-weight: bold; }
        #survey-frame { width: 100%; height: auto; min-height: 300px; border: none; display: block; overflow: hidden !important; margin-top: 140px; }
        
        /* –í–´–î–ê–ß–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê */
        .btn-copy { background-color: #1976d2; color: white; border: none; padding: 12px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; text-transform: uppercase; position: fixed; top: 53px; right: 10px; width: calc(45% - 10px); z-index: 1001; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center; }
        
        #output { 
            width: calc(45% - 10px); 
            position: fixed;
            top: 105px; 
            right: 10px;
            bottom: 10px; 
            height: auto; 
            max-height: none; 
            overflow-y: auto; 
            padding: 10px 12px; 
            border-radius: 4px; 
            border: 1px solid #b0bec5; 
            font-family: 'Segoe UI', sans-serif; 
            font-size: 13px; 
            background: white; 
            white-space: pre-wrap; 
            box-sizing: border-box; 
            color: #263238; 
            line-height: 1.3; 
            margin-top: 0;
            scrollbar-width: none; 
            -ms-overflow-style: none; 
        }
        #output::-webkit-scrollbar { display: none; }

        .res-row { margin-bottom: 2px; display: block; transition: background-color 0.3s ease; border-left: 3px solid transparent; }
        .res-label { font-weight: 800; color: #1565c0; text-transform: uppercase; font-size: 11px; margin-right: 4px; }
        .res-value { font-family: 'Consolas', 'Courier New', monospace; color: #000; font-size: 13px; }
        
        .res-row.active-focus {
            background-color: #fff9c4;
            border-left: 3px solid #00c853;
            padding-left: 4px;
        }
        
        @media (max-width: 900px) { 
            .main-wrapper { flex-direction: column; padding-right: 5px; margin-top: 50px; } 
            .form-side, .result-side { flex: 0 0 100%; width: 100%; position: static; } 
            .sticky-header { position: static !important; width: 100% !important; } 
            #survey-frame { margin-top: 0 !important; } 
            .btn-copy { position: static; width: 100%; margin-bottom: 8px; } 
            #output { position: static; width: 100%; margin-top: 0; transform: none !important; max-height: none; } 
        }
    </style>
</head>
<body>

<div class="header-nav" id="menu">
    <div style="display: flex; gap: 5px; justify-self: start;">
        <button class="clear-btn" onclick="clearAllData()" title="–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞">‚úï</button>
        <button class="pin-btn active" id="master-pin-btn" onclick="togglePin()" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å/–æ—Ç–∫—Ä–µ–ø–∏—Ç—å —à–∞–ø–∫—É –∑–∞—è–≤–∫–∏">üìå</button>
    </div>
    
    <div style="display: flex; gap: 5px; justify-content: center;">
        <button class="nav-btn active" onclick="openSurvey('short.html', this)">–ö–æ—Ä–æ—Ç–∫–∏–π</button>
        <button class="nav-btn" onclick="openSurvey('elderly.html', this)">–°—Ç–∞—Ä–∏–∫–∏</button>
        <button class="nav-btn" onclick="openSurvey('teens.html', this)">–ü–æ–¥—Ä–æ—Å—Ç–∫–∏</button>
        <button class="nav-btn" onclick="openSurvey('forest.html', this)">–õ–µ—Å</button>
        <button class="nav-btn" onclick="openSurvey('adults.html', this)">–í–∑—Ä–æ—Å–ª—ã–µ</button>
    </div>
    
    <div style="display: flex; gap: 5px; justify-self: end; padding-right: 10px;">
        <button class="nav-btn" onclick="exportToJson()" title="–í—ã–≥—Ä—É–∑–∏—Ç—å JSON">üíæ</button>
        <button class="nav-btn" onclick="document.getElementById('import-file').click()" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON">üìÇ</button>
        <input type="file" id="import-file" style="display:none" onchange="importFromJson(this)" accept=".json">
    </div>
</div>

<div class="main-wrapper">
    <div class="form-side">
        <div class="sticky-header" id="master-sticky">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <label style="font-weight: bold; text-decoration: underline; font-size: 13px; color: #37474f;">–ó–ê–Ø–í–ö–ê</label>
                <button id="z_edit_btn" onclick="editZ()" style="display: none; background: #90a4ae; color: white; border: none; border-radius: 4px; padding: 2px 8px; font-size: 10px; cursor: pointer;">–ò–ó–ú–ï–ù–ò–¢–¨</button>
            </div>
            <textarea id="z_text" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏..."></textarea>
            <div id="z_fixed"><div id="z_value"></div></div>
            <button id="z_confirm_btn" class="btn-ok" onclick="fixZ()">–û–ö</button>
        </div>
        <iframe src="short.html" id="survey-frame" scrolling="no"></iframe>
    </div>
    
    <div class="result-side">
        <button class="btn-copy" id="copy-btn" onclick="copyText()">
            <span>–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
            <span id="save-status">–û–±–Ω–æ–≤–ª–µ–Ω–æ: --:--:--</span>
        </button>
        <div id="output">–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–æ—Å–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
    </div>
</div>

<script>
    var ORDER = ['short', 'elderly', 'teens', 'forest', 'adults']; 
    // globalZData ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏
    var globalZData = localStorage.getItem('pso_z_main') || "";
    // globalCallsignData ‚Äî "–ü–æ–∑—ã–≤–Ω–æ–π / –î–∞—Ç–∞ / –í—Ä–µ–º—è" (–∏–¥–µ—Ç –≤ –≤—ã–¥–∞—á—É)
    var globalCallsignData = localStorage.getItem('pso_global_callsign_data') || ""; 
    var globalFields = JSON.parse(localStorage.getItem('pso_global_fields') || "{}"); 
    
    var currentSource = localStorage.getItem('last_survey_file') ? localStorage.getItem('last_survey_file').replace('.html', '') : 'short';
    var scrollTimeout;

    function adjustFrameOffset() {
        var header = document.getElementById('master-sticky');
        var frame = document.getElementById('survey-frame');
        if (header && frame && !header.classList.contains('unpinned') && window.innerWidth > 900) {
            frame.style.marginTop = (header.offsetHeight + 10) + 'px';
        } else {
            if (frame) frame.style.marginTop = '0px';
        }
    }

    function togglePin() {
        var btn = document.getElementById('master-pin-btn');
        var header = document.getElementById('master-sticky');
        if (!btn || !header) return;
        var isActive = btn.classList.toggle('active');
        header.classList.toggle('unpinned', !isActive);
        adjustFrameOffset();
    }

    // –õ–û–ì–ò–ö–ê –ë–õ–û–ö–ê –ó–ê–Ø–í–ö–ê
    function fixZ() {
        var val = document.getElementById('z_text').value; 
        globalZData = val;
        localStorage.setItem('pso_z_main', val);
        
        if (val.trim() !== "") {
            renderZ(val);
        }
    }

    function renderZ(text) {
        var valDiv = document.getElementById('z_value');
        if (!valDiv) return;
        valDiv.innerHTML = "";
        var lines = text.split('\n');
        lines.forEach(function(line) {
            var span = document.createElement('span');
            span.innerText = line || ' ';
            valDiv.appendChild(span);
        });
        document.getElementById('z_text').style.display = 'none';
        document.getElementById('z_confirm_btn').style.display = 'none';
        document.getElementById('z_fixed').style.display = 'block';
        document.getElementById('z_edit_btn').style.display = 'block';
        setTimeout(adjustFrameOffset, 30);
    }

    function editZ() {
        var zInput = document.getElementById('z_text');
        zInput.value = globalZData;
        zInput.style.display = 'block';
        document.getElementById('z_confirm_btn').style.display = 'block';
        document.getElementById('z_fixed').style.display = 'none';
        document.getElementById('z_edit_btn').style.display = 'none';
        setTimeout(adjustFrameOffset, 30);
    }

    function broadcastData(call, fields) {
        var frame = document.getElementById('survey-frame');
        if (frame && frame.contentWindow) {
            frame.contentWindow.postMessage({ type: 'set_global_data', value: call, fields: fields }, '*');
        }
    }

    function openSurvey(fileName, btn) {
        var frame = document.getElementById('survey-frame');
        if (!frame) return;
        currentSource = fileName.replace('.html', '');
        frame.src = fileName;
        var navBtns = document.querySelectorAll('.nav-btn');
        navBtns.forEach(function(b) { b.classList.remove('active'); });
        if (btn) btn.classList.add('active');
        localStorage.setItem('last_survey_file', fileName);
        
        frame.onload = function() {
            broadcastData(globalCallsignData, globalFields);
            adjustFrameOffset();
            updateFinalOutput();
        };
    }

    function clearAllData() {
        if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function updateFinalOutput() {
        var outDiv = document.getElementById('output');
        if (!outDiv) return;
        outDiv.innerHTML = ""; 

        // 1. –í –í–´–î–ê–ß–£ –ò–î–ï–¢ –¢–û–õ–¨–ö–û –ü–û–ó–´–í–ù–û–ô/–î–ê–¢–ê
        var currentCall = globalCallsignData || "";

        if (currentCall.trim() !== "") {
            var callDiv = document.createElement('div');
            callDiv.style.fontWeight = "bold";
            callDiv.style.marginBottom = "20px";
            callDiv.style.whiteSpace = "pre-wrap"; 
            callDiv.innerText = currentCall;
            outDiv.appendChild(callDiv);
        }

        // 2. –î–∞–Ω–Ω—ã–µ –∞–Ω–∫–µ—Ç—ã
        var raw = localStorage.getItem('survey_text_' + currentSource);
        if (raw) {
            try {
                var payload = JSON.parse(raw);
                if (Array.isArray(payload)) {
                    payload.forEach(function(item, index) {
                        var row = document.createElement('div');
                        row.className = 'res-row';
                        row.id = 'row-' + currentSource + '-' + index;
                        if (item.label && item.label.trim() !== "") {
                            row.innerHTML = '<span class="res-label">' + item.label + ':</span> <span class="res-value">' + item.value + '</span>';
                        } else {
                            row.innerHTML = '<span class="res-value">' + item.value + '</span>';
                        }
                        outDiv.appendChild(row);
                    });
                }
            } catch(e) { console.error("–û—à–∏–±–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏", e); }
        }

        if (outDiv.innerHTML === "") outDiv.innerText = "–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–æ—Å–∞ [" + currentSource + "] –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...";

        var status = document.getElementById('save-status');
        if (status) {
            var timeStrStatus = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            status.innerText = "–û–±–Ω–æ–≤–ª–µ–Ω–æ " + timeStrStatus;
        }
    }

    window.addEventListener('message', function(event) {
        if (event.data.type === 'survey_update') {
            localStorage.setItem('survey_text_' + event.data.source, JSON.stringify(event.data.payload));
            if (event.data.source === currentSource) updateFinalOutput();
        }

        if (event.data.type === 'sync_scroll') {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(function() {
                var targetId = 'row-' + event.data.source + '-' + event.data.index;
                var targetRow = document.getElementById(targetId);
                var outputBox = document.getElementById('output');
                if (targetRow && outputBox) {
                    document.querySelectorAll('.res-row').forEach(function(r) { r.classList.remove('active-focus'); });
                    targetRow.classList.add('active-focus');
                    var scrollTarget = targetRow.offsetTop - outputBox.offsetTop - (outputBox.clientHeight / 3);
                    outputBox.scrollTo({ top: scrollTarget, behavior: 'smooth' });
                }
            }, 100);
        }

        if (event.data.type === 'sync_globals') {
            if (globalCallsignData !== event.data.value) {
                globalCallsignData = event.data.value;
                localStorage.setItem('pso_global_callsign_data', globalCallsignData);
                updateFinalOutput();
            }
        }

        if (event.data.type === 'sync_field') {
            if (globalFields[event.data.fieldId] !== event.data.value) {
                globalFields[event.data.fieldId] = event.data.value;
                localStorage.setItem('pso_global_fields', JSON.stringify(globalFields));
                broadcastData(globalCallsignData, globalFields);
            }
        }

        if (event.data.type === 'set_height') {
            var frame = document.getElementById('survey-frame');
            if (frame && event.data.height) {
                frame.style.height = event.data.height + 'px';
                adjustFrameOffset();
            }
        }
    });

    function copyText() {
    var out = document.getElementById('output');
    if (!out || out.innerText.indexOf('–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–æ—Å–∞') === 0) return;

    var finalString = "";
    
    // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ output
    var elements = out.childNodes;
    elements.forEach(function(node) {
        // –ï—Å–ª–∏ —ç—Ç–æ div —Å –¥–∞–Ω–Ω—ã–º–∏ –∞–Ω–∫–µ—Ç—ã –∏–ª–∏ –ø–æ–∑—ã–≤–Ω—ã–º
        if (node.nodeType === 1) { 
            // –ö–ª–æ–Ω–∏—Ä—É–µ–º —É–∑–µ–ª, —á—Ç–æ–±—ã –Ω–µ –∏—Å–ø–æ—Ä—Ç–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            var tempNode = node.cloneNode(true);
            
            // –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –µ—Å—Ç—å label (–ø—Ä–µ—Ñ–∏–∫—Å), —É–±–∏—Ä–∞–µ–º —É –Ω–µ–≥–æ –∫–∞–ø—Å —Å—Ç–∏–ª—è
            var labels = tempNode.querySelectorAll('.res-label');
            labels.forEach(function(l) {
                l.style.textTransform = 'none';
            });

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —ç—Ç–æ–≥–æ —É–∑–ª–∞ –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏
            finalString += tempNode.innerText.trim() + "\n";
        }
    });

    // –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
    var tempArea = document.createElement('textarea');
    tempArea.value = finalString.trim(); // trim —É–±–µ—Ä–µ—Ç –ª–∏—à–Ω–∏–π –ø–µ—Ä–µ–Ω–æ—Å –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ
    document.body.appendChild(tempArea);
    tempArea.select();
    document.execCommand('copy');
    document.body.removeChild(tempArea);

    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
    var btn = document.getElementById('copy-btn');
    if (btn) {
        var oldContent = btn.innerHTML;
        btn.innerHTML = "<span>–°–ö–û–ü–ò–†–û–í–ê–ù–û!</span>";
        btn.style.backgroundColor = "#00c853";
        setTimeout(function() { 
            btn.innerHTML = oldContent; 
            btn.style.backgroundColor = "#1976d2"; 
        }, 1200);
    }
}

    window.onload = function() {
        // 1. –ó–ê–Ø–í–ö–ê: –ï—Å–ª–∏ –ø—É—Å—Ç–∞—è ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–ª—è –≤–≤–æ–¥–∞ —Å—Ä–∞–∑—É
        var savedZ = localStorage.getItem('pso_z_main') || "";
        globalZData = savedZ;
        document.getElementById('z_text').value = savedZ;
        
        if (savedZ.trim() === "") {
            editZ(); // –ü–æ–ª–µ –∞–∫—Ç–∏–≤–Ω–æ —Å—Ä–∞–∑—É
        } else {
            renderZ(savedZ); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å
        }

        // 2. –ü–û–ó–´–í–ù–û–ô/–î–ê–¢–ê: –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è–µ–º —Å–∏—Å—Ç–µ–º–Ω–æ
        var savedCall = localStorage.getItem('pso_global_callsign_data');
        if (!savedCall || savedCall.trim() === "") {
            var now = new Date();
            var dateStr = now.toLocaleDateString('ru-RU');
            var timeStr = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            savedCall = dateStr + " " + timeStr + "\n";
            localStorage.setItem('pso_global_callsign_data', savedCall);
        }
        globalCallsignData = savedCall;
        
        var lastFile = localStorage.getItem('last_survey_file') || 'short.html';
        var buttons = document.querySelectorAll('.nav-btn');
        var found = false;
        buttons.forEach(function(btn) {
            if (btn.getAttribute('onclick') && btn.getAttribute('onclick').indexOf(lastFile) !== -1) {
                openSurvey(lastFile, btn);
                found = true;
            }
        });
        if(!found && buttons.length > 0) openSurvey('short.html', buttons);

        updateFinalOutput();
    };

    window.addEventListener('resize', adjustFrameOffset);
    
    function exportToJson() {
        var backup = {};
        for (var i = 0; i < localStorage.length; i++) {
            var key = localStorage.key(i);
            if (key.indexOf('survey_') === 0 || key.indexOf('pso_') === 0 || key === 'last_survey_file' || key === 'pso_last_gender') {
                backup[key] = localStorage.getItem(key);
            }
        }
        var jsonString = JSON.stringify(backup, null, 2);
        var blob = new Blob([jsonString], { type: "application/json" });
        var url = URL.createObjectURL(blob);
        var downloadLink = document.createElement('a');
        var time = new Date().toLocaleTimeString('ru-RU').replace(/:/g, '-');
        downloadLink.href = url;
        downloadLink.download = "pso_backup_" + time + ".json";
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
        URL.revokeObjectURL(url);
    }

    function importFromJson(el) {
        if (!el || !el.files || el.files.length === 0) return;
        var fileToLoad = el.files[0]; 
        var reader = new FileReader();
        reader.onload = function(e) {
            try {
                var data = JSON.parse(e.target.result);
                if (confirm("–ó–∞–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?")) {
                    localStorage.clear();
                    for (var key in data) { localStorage.setItem(key, data[key]); }
                    location.reload();
                }
            } catch (err) { alert("–û—à–∏–±–∫–∞ —Ñ–∞–π–ª–∞"); }
        };
        reader.readAsText(fileToLoad);
        el.value = "";
    }

    window.addEventListener("drop", function(e) {
        e.preventDefault();
        var files = e.dataTransfer.files;
        if (files.length > 0) importFromJson({ files: files });
    }, false);
</script>
</body>
</html>